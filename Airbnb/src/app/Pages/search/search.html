<!-- search.html -->
<nav class="navbar">
  <!-- Top Row: Logo, Property Filters, Icons -->
  <div class="navbar-top">
    <div class="navbar-brand">airbnb</div>

    <!-- Property Type Filter Bar - Hide on Admin Page and Trips Page and Account Page -->
    <div class="property-type-bar" *ngIf="!isAdminPage && !isTripsPage && !isAccountPage">
      <div class="property-type-filters">

        <div *ngFor="let type of propertyTypes" class="property-type-option"
          [class.active]="selectedPropertyType === type.value" (click)="selectPropertyType(type.value)">
          <span class="type-icon" [ngSwitch]="type.value">
            <!-- All -->
            <img *ngSwitchCase="'all'" src="/assets/default-listing.jpg" alt="All"
              style="display: block; height: 60px; width: 60px; object-fit: cover; border-radius: 50%;">
            <!-- Properties (Home) -->
            <img *ngSwitchCase="'property'" src="/assets/icon-properties.png" alt="Properties"
              style="display: block; height: 60px; width: 60px; object-fit: contain;">

            <!-- Experiences (Ticket/Activity) -->
            <img *ngSwitchCase="'experience'" src="/assets/icon-experiences.png" alt="Experiences"
              style="display: block; height: 60px; width: 60px; object-fit: contain;">

            <!-- Services (Tools) -->
            <img *ngSwitchCase="'service'" src="/assets/icon-services.png" alt="Services"
              style="display: block; height: 60px; width: 60px; object-fit: contain;">
          </span>
          {{ type.label }}
        </div>
      </div>
    </div>

    <!-- Right Side Icons -->
    <div class="navbar-actions">
      <!-- My Trips Direct Link -->


      <!-- User Menu -->
      <div class="user-menu-wrapper">
        <div class="user-menu" (click)="toggleMenuPanel()">
          <button class="user-menu-btn">
            <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation"
              focusable="false"
              style="display: block; fill: none; height: 16px; width: 16px; stroke: currentcolor; stroke-width: 3; overflow: visible;">
              <g fill="none">
                <path d="M2 16h28"></path>
                <path d="M2 24h28"></path>
                <path d="M2 8h28"></path>
              </g>
            </svg>
            <div class="user-avatar" *ngIf="isAuthenticated && currentUser; else guestAvatar">
              <img *ngIf="currentUser?.photoURL" [src]="currentUser.photoURL" alt="Profile"
                style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
              <span *ngIf="!currentUser?.photoURL">{{ getUserInitials() }}</span>
            </div>
            <ng-template #guestAvatar>
              <div class="user-avatar guest">
                <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation"
                  focusable="false" style="display: block; height: 16px; width: 16px; fill: currentcolor;">
                  <path
                    d="M16 .7C7.56.7.7 7.56.7 16S7.56 31.3 16 31.3 31.3 24.44 31.3 16 24.44.7 16 .7zm0 28c-4.02 0-7.6-1.88-9.93-4.81a12.43 12.43 0 0 1 6.45-4.4A6.5 6.5 0 0 1 9.5 14a6.5 6.5 0 0 1 13 0 6.51 6.51 0 0 1-3.02 5.5 12.42 12.42 0 0 1 6.45 4.4A12.67 12.67 0 0 1 16 28.7z">
                  </path>
                </svg>
              </div>
            </ng-template>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Row: Main Search Bar -->
  <div class="navbar-bottom">
    <!-- Filter Button - Hide on Admin Page -->
    <!-- Filter Button - Hide on Admin Page and Trips Page -->
    <!-- Filter Button Removed -->

    <div class="search-bar" *ngIf="!isAdminPage && !isTripsPage && !isAccountPage">
      <!-- Where -->
      <div class="search-section" [class.active]="activePanel === 'location'" (click)="openPanel('location')">
        <div class="search-label">Where</div>
        <div class="search-value">{{ getLocationDisplay() }}</div>
      </div>

      <!-- When -->
      <div class="search-section" [class.active]="activePanel === 'dates'" (click)="openPanel('dates')">
        <div class="search-label">When</div>
        <div class="search-value">{{ getDatesDisplay() }}</div>
      </div>

      <!-- Who -->
      <div class="search-section" [class.active]="activePanel === 'guests'" (click)="openPanel('guests')">
        <div class="search-label">Who</div>
        <div class="search-value">{{ getGuestsDisplay() }}</div>
      </div>
      <div class="search-button">
        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation"
          focusable="false"
          style="display: block; fill: none; height: 16px; width: 16px; stroke: currentcolor; stroke-width: 4; overflow: visible;">
          <path fill="none" d="M13 24a11 11 0 1 0 0-22 11 11 0 0 0 0 22zm8-3 9 9"></path>
        </svg>
      </div>
    </div>
  </div>

  <!-- Admin Home Button -->
  <!-- Admin/Account Home Button -->
  <div class="admin-nav-container" *ngIf="isAdminPage || isAccountPage">
    <a routerLink="/" class="admin-home-btn">
      <span class="home-icon">üè†</span>
      Go to Home
    </a>
  </div>

</nav>

<!-- Language Selection Panel -->
<div class="language-panel" [class.active]="showLanguagePanel">
  <div class="panel-header">
    <h3 class="panel-title">Choose a language</h3>
    <button class="close-panel" (click)="toggleLanguagePanel()">√ó</button>
  </div>
  <div class="language-list">
    <div *ngFor="let language of languages" class="language-option"
      [class.selected]="selectedLanguage.code === language.code" (click)="selectLanguage(language)">
      <span class="language-flag">{{ language.flag }}</span>
      <span class="language-name">{{ language.name }}</span>
    </div>
  </div>
</div>

<!-- Menu Panel -->
<div class="menu-panel scrollable" [class.active]="showMenuPanel">
  <div class="panel-header">
    <h3 class="panel-title">Menu</h3>
    <button class="close-panel" (click)="toggleMenuPanel()">√ó</button>
  </div>

  <div class="menu-list">
    <!-- User info section -->
    <div class="user-section" *ngIf="isAuthenticated && currentUser">
      <div class="user-avatar-large">
        <img *ngIf="currentUser?.photoURL" [src]="currentUser.photoURL" alt="Profile"
          style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
        <span *ngIf="!currentUser?.photoURL">{{ getUserInitials() }}</span>
      </div>
      <div class="user-details">
        <h3 class="user-fullname">{{ currentUser.firstName }} {{ currentUser.lastName }}</h3>
        <p class="user-email">{{ currentUser.email }}</p>
      </div>
    </div>

    <!-- Menu items -->
    <div *ngFor="let item of menuItems" class="menu-section">
      <div *ngIf="item.separator" class="menu-separator"></div>

      <div *ngIf="!item.separator && item.action !== 'logout'" class="menu-option" (click)="onMenuItemClick(item)">
        <span class="menu-icon">{{ item.icon }}</span>
        <div class="menu-content">
          <span class="menu-label">{{ item.label }}</span>
        </div>
      </div>
    </div>

    <!-- Logout section -->
    <div class="logout-section" *ngIf="isAuthenticated">
      <div class="menu-separator"></div>
      <button class="logout-btn styled" (click)="logout()">
        <span class="logout-icon">üö™</span>
        <span class="logout-label">Log out</span>
      </button>
    </div>
  </div>
</div>

<!-- Location Panel -->
<div class="filter-panel" [class.active]="activePanel === 'location'">
  <div class="filter-header">
    <h2 class="filter-title">Where to?</h2>
    <button class="close-filter" (click)="closePanel()">√ó</button>
  </div>

  <div class="location-grid">
    <div *ngFor="let location of locationOptions" class="location-option"
      [class.selected]="currentFilters.location === location.value" (click)="selectLocation(location.value)">
      <div class="location-icon">{{ location.icon }}</div>
      <div class="location-info">
        <h3>{{ location.label }}</h3>
        <p>{{ location.description }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Dates Panel -->
<div class="filter-panel" [class.active]="activePanel === 'dates'">
  <div class="filter-header">
    <h2 class="filter-title">When's your trip?</h2>
    <button class="close-filter" (click)="closePanel()">√ó</button>
  </div>

  <div class="dates-content">
    <!-- Selected dates display -->
    <div class="selected-dates" *ngIf="dateSelection.start || dateSelection.end">
      <div class="date-range">
        <span *ngIf="dateSelection.start">{{ formatDate(dateSelection.start) }}</span>
        <span *ngIf="dateSelection.start && dateSelection.end"> ‚Äì </span>
        <span *ngIf="dateSelection.end">{{ formatDate(dateSelection.end) }}</span>
      </div>
      <button class="clear-dates" (click)="clearDates()">Clear dates</button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button class="quick-action-btn" (click)="goToCurrentMonth()">
        Today
      </button>
      <button class="quick-action-btn" (click)="selectNextWeekend()">
        Next weekend
      </button>
      <button class="quick-action-btn" (click)="selectNextWeek()">
        Next week
      </button>
      <button class="quick-action-btn" (click)="selectNextMonth()">
        Next month
      </button>
    </div>

    <div class="calendar">
      <!-- Calendar navigation -->
      <div class="calendar-header">
        <div class="nav-controls">
          <button class="nav-button nav-year" [class.disabled]="!canNavigatePrev()"
            (click)="canNavigatePrev() && navigateYear(-1)" title="Previous year">
            ‚Äπ‚Äπ
          </button>
          <button class="nav-button nav-month" [class.disabled]="!canNavigatePrev()"
            (click)="canNavigatePrev() && navigateMonth(-1)" title="Previous month">
            ‚Äπ
          </button>
        </div>

        <div class="view-controls">
          <button class="view-button" [class.active]="calendarView === 'month'" (click)="switchToMonthView()">
            üìÖ {{ getMonthYearDisplay() }}
          </button>
          <button class="view-button" [class.active]="calendarView === 'year'" (click)="switchToYearView()">
            üóìÔ∏è {{ currentMonth.getFullYear() }}
          </button>
          <button class="view-button" [class.active]="calendarView === 'decade'" (click)="switchToDecadeView()">
            üìä {{ getCurrentDecade() }}s
          </button>
        </div>

        <div class="nav-controls">
          <button class="nav-button nav-month" [class.disabled]="!canNavigateNext()"
            (click)="canNavigateNext() && navigateMonth(1)" title="Next month">
            ‚Ä∫
          </button>
          <button class="nav-button nav-year" [class.disabled]="!canNavigateNext()"
            (click)="canNavigateNext() && navigateYear(1)" title="Next year">
            ‚Ä∫‚Ä∫
          </button>
        </div>
      </div>

      <!-- Month View -->
      <div class="calendar-view month-view" *ngIf="calendarView === 'month'">
        <div class="calendar-grid">
          <div class="weekday" *ngFor="let day of ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa']">
            {{ day }}
          </div>

          <div *ngFor="let date of getCalendarDays()" class="calendar-day" [class.in-range]="isDateInRange(date)"
            [class.selected]="isDateSelected(date)" [class.start-date]="isDateStart(date)"
            [class.end-date]="isDateEnd(date)" [class.disabled]="isDateDisabled(date)"
            [class.other-month]="date.getMonth() !== currentMonth.getMonth()" [class.today]="isToday(date)"
            (click)="selectDate(date)">
            {{ date.getDate() }}
            <div class="date-tooltip" *ngIf="isDateDisabled(date)">
              {{ isPastDate(date) ? 'Past date' : 'Date not available' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Year View -->
      <div class="calendar-view year-view" *ngIf="calendarView === 'year'">
        <div class="year-grid">
          <div *ngFor="let month of getMonthsForYear()" class="month-option"
            [class.current]="month.number === currentMonth.getMonth()" (click)="selectMonth(month.number)">
            {{ month.name }}
          </div>
        </div>
      </div>

      <!-- Decade View -->
      <div class="calendar-view decade-view" *ngIf="calendarView === 'decade'">
        <div class="decade-grid">
          <div *ngFor="let decade of availableDecades" class="decade-option" [class.current]="isCurrentDecade(decade)"
            (click)="selectDecade(decade)">
            {{ decade }} - {{ decade + 9 }}
          </div>
        </div>
      </div>
    </div>

    <!-- Date range info -->
    <div class="date-info" *ngIf="dateSelection.start && !dateSelection.end">
      <p>üéØ Now select your checkout date to complete your trip</p>
    </div>
  </div>
</div>

<!-- Guests Panel -->
<div class="filter-panel" [class.active]="activePanel === 'guests'">
  <div class="filter-header">
    <h2 class="filter-title">Who's coming?</h2>
    <button class="close-filter" (click)="closePanel()">√ó</button>
  </div>

  <div class="guests-content">
    <!-- Adults -->
    <!-- Single Guest Counter -->
    <div class="guest-type">
      <div class="guest-info">
        <h3>Guests</h3>
        <p>Add guests</p>
      </div>
      <div class="guest-counter">
        <button class="counter-btn" [class.disabled]="guestSelection.adults === 0"
          (click)="updateGuests('adults', -1)">‚àí</button>
        <span class="counter-value">{{ guestSelection.adults }}</span>
        <button class="counter-btn" (click)="updateGuests('adults', 1)">+</button>
      </div>
    </div>

    <div class="guests-footer">
      <button class="clear-guests" (click)="clearGuests()">Clear all</button>
    </div>
  </div>
</div>

<!-- Overlay -->
<div class="overlay" [class.active]="activePanel !== null || showMenuPanel || showLanguagePanel"
  (click)="closeAllPanels()"></div>