<!-- search.html -->
<!-- Main Navbar -->
<nav class="navbar">
  <!-- Top Row: Logo, Property Filters, Icons -->
  <div class="navbar-top">
    <div class="navbar-brand">airbnb</div>

    <!-- Property Type Filter Bar -->
    <div class="property-type-bar">
      <div class="property-type-filters">
        <div *ngFor="let type of propertyTypes" class="property-type-option"
          [class.active]="selectedPropertyType === type.value" (click)="selectPropertyType(type.value)">
          <span class="type-icon" [ngSwitch]="type.value">
            <!-- All -->
            <svg *ngSwitchCase="'all'" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
              role="presentation" focusable="false"
              style="display: block; height: 16px; width: 16px; fill: currentcolor;">
              <path
                d="M16 1a15 15 0 1 1 0 30 15 15 0 0 1 0-30zm0 2a13 13 0 1 0 0 26 13 13 0 0 0 0-26zm0 13a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm-6 0a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm12 0a2 2 0 1 1 0 4 2 2 0 0 1 0-4z">
              </path>
            </svg>
            <!-- Properties (Home) -->
            <svg *ngSwitchCase="'property'" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
              role="presentation" focusable="false"
              style="display: block; height: 16px; width: 16px; fill: currentcolor;">
              <path d="M16 1L1 16h3v15h9V20h6v11h9V16h3L16 1zm0 2.83L25.17 13H25v16h-5V18h-8v11H7V13h-.17L16 3.83z">
              </path>
            </svg>
            <!-- Experiences (Ticket/Activity) -->
            <svg *ngSwitchCase="'experience'" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
              role="presentation" focusable="false"
              style="display: block; height: 16px; width: 16px; fill: currentcolor;">
              <path
                d="M26 4.5A2.5 2.5 0 0 0 23.5 7v1H22V6.5a2.5 2.5 0 0 0-5 0V8h-2V6.5a2.5 2.5 0 0 0-5 0V8H8.5A2.5 2.5 0 0 0 6 10.5V26a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V10.5A2.5 2.5 0 0 0 23.5 8H22a2.5 2.5 0 0 0 1.5-2.25V4.5zM12 6.5a.5.5 0 0 1 1 0V8h-1V6.5zm5 0a.5.5 0 0 1 1 0V8h-1V6.5zm5 .5V8h-1V7a.5.5 0 0 1 1 0zM24 26a3 3 0 0 1-3 3H11a3 3 0 0 1-3-3V10.5a.5.5 0 0 1 .5-.5h15a.5.5 0 0 1 .5.5V26z">
              </path>
            </svg>
            <!-- Services (Tools) -->
            <svg *ngSwitchCase="'service'" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
              role="presentation" focusable="false"
              style="display: block; height: 16px; width: 16px; fill: currentcolor;">
              <path
                d="M23.5 13.5l-4-4L22 7l-2-2-2.5 2.5-4-4L12 5l2.5 2.5L10 12l-7 7 5 5 7-7 4.5 4.5 1.5-1.5-4-4 2.5-2.5 2-2 1.5 2.5zM8.5 22.5l-2-2 7-7 2 2-7 7z">
              </path>
            </svg>
          </span>
          {{ type.label }}
        </div>
      </div>
    </div>

    <!-- Right Side Icons -->
    <div class="navbar-actions">
      <!-- My Trips Direct Link -->
      <div class="nav-icon" routerLink="/trips" title="My Trips" *ngIf="isAuthenticated">
        <span style="font-size: 18px;">‚úàÔ∏è</span>
      </div>
      <!-- Language Selector -->
      <!-- <div class="nav-icon" (click)="toggleLanguagePanel()" title="Choose language">
        <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false">
          <path d="M8 .25a7.77 7.77 0 0 1 7.75 7.78 7.75 7.75 0 0 1-7.52 7.72h-.25A7.75 7.75 0 0 1 .25 8.24v-.25A7.75 7.75 0 0 1 8 .25zm1.95 8.5h-3.9c.15 2.9 1.17 5.34 1.88 5.5H8c.68 0 1.72-2.37 1.93-5.23zm4.26 0h-2.76c-.09 1.96-.53 3.75-1.11 4.86 2.47-.88 3.85-2.8 3.87-4.86zM2.58 8.75h2.76c.09-1.96.54-3.75 1.11-4.86-2.46.88-3.84 2.8-3.87 4.86zm3.93-6.24c-.68 0-1.72 2.37-1.93 5.23h3.9c-.15-2.9-1.17-5.34-1.88-5.5zm4.26 0h-2.76c.09-1.96.53-3.75 1.11-4.86 2.47.88 3.85 2.8 3.87 4.86zM8 1.25c-.68 0-1.72 2.37-1.93 5.23h3.86C9.72 3.62 8.68 1.25 8 1.25z"></path>
        </svg>
      </div> -->

      <!-- User Menu -->
      <div class="user-menu-wrapper">
        <div class="user-menu" (click)="toggleMenuPanel()">
          <button class="user-menu-btn">
            <!-- Enhanced user display -->
            <div class="user-display" *ngIf="isAuthenticated && currentUser; else loginDisplay">
              <div class="user-avatar">
                {{ getUserInitials() }}
              </div>
              <div class="user-info">
                <span class="user-name">{{ getUserDisplayName() }}</span>
              </div>
              <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation"
                focusable="false" class="chevron">
                <path
                  d="M4.47 5.72a.75.75 0 0 1 1.06 0L8 8.19l2.47-2.47a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06z">
                </path>
              </svg>
            </div>
            <ng-template #loginDisplay>
              <div class="user-display">
                <div class="user-avatar guest">
                  <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation"
                    focusable="false">
                    <path
                      d="M16 .7C7.56.7.7 7.56.7 16S7.56 31.3 16 31.3 31.3 24.44 31.3 16 24.44.7 16 .7zm0 28c-4.02 0-7.6-1.88-9.93-4.81a12.43 12.43 0 0 1 6.45-4.4A6.5 6.5 0 0 1 9.5 14a6.5 6.5 0 0 1 13 0 6.51 6.51 0 0 1-3.02 5.5 12.42 12.42 0 0 1 6.45 4.4A12.67 12.67 0 0 1 16 28.7z">
                    </path>
                  </svg>
                </div>
                <div class="user-info">
                  <span class="user-name">{{ getUserDisplayName() }}</span>
                </div>
                <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation"
                  focusable="false" class="chevron">
                  <path
                    d="M4.47 5.72a.75.75 0 0 1 1.06 0L8 8.19l2.47-2.47a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06z">
                  </path>
                </svg>
              </div>
            </ng-template>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Row: Main Search Bar -->
  <div class="navbar-bottom">
    <div class="search-bar">
      <!-- Where -->
      <div class="search-section" [class.active]="activePanel === 'location'" (click)="openPanel('location')">
        <div class="search-label">Where</div>
        <div class="search-value">{{ getLocationDisplay() }}</div>
      </div>

      <!-- When -->
      <div class="search-section" [class.active]="activePanel === 'dates'" (click)="openPanel('dates')">
        <div class="search-label">When</div>
        <div class="search-value">{{ getDatesDisplay() }}</div>
      </div>

      <!-- Who -->
      <div class="search-section" [class.active]="activePanel === 'guests'" (click)="openPanel('guests')">
        <div class="search-label">Who</div>
        <div class="search-value">{{ getGuestsDisplay() }}</div>
      </div>

      <!-- Search Button -->
      <!-- <button class="search-button" (click)="onSearch()">
        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false">
          <path d="M13 0a13 13 0 0 1 10.5 20.67l7.91 7.92-2.82 2.82-7.92-7.91A13 13 0 1 1 13 0zm0 2a11 11 0 1 0 0 22 11 11 0 0 0 0-22z"></path>
        </svg>
      </button> -->
    </div>
  </div>
</nav>

<!-- Language Selection Panel -->
<div class="language-panel" [class.active]="showLanguagePanel">
  <div class="panel-header">
    <h3 class="panel-title">Choose a language</h3>
    <button class="close-panel" (click)="toggleLanguagePanel()">√ó</button>
  </div>
  <div class="language-list">
    <div *ngFor="let language of languages" class="language-option"
      [class.selected]="selectedLanguage.code === language.code" (click)="selectLanguage(language)">
      <span class="language-flag">{{ language.flag }}</span>
      <span class="language-name">{{ language.name }}</span>
    </div>
  </div>
</div>

<!-- Menu Panel -->
<div class="menu-panel scrollable" [class.active]="showMenuPanel">
  <div class="panel-header">
    <h3 class="panel-title">Menu</h3>
    <button class="close-panel" (click)="toggleMenuPanel()">√ó</button>
  </div>

  <div class="menu-list">
    <!-- User info section -->
    <div class="user-section" *ngIf="isAuthenticated && currentUser">
      <div class="user-avatar-large">
        {{ getUserInitials() }}
      </div>
      <div class="user-details">
        <h3 class="user-fullname">{{ currentUser.firstName }} {{ currentUser.lastName }}</h3>
        <p class="user-email">{{ currentUser.email }}</p>
      </div>
    </div>

    <!-- Menu items -->
    <div *ngFor="let item of menuItems" class="menu-section">
      <div *ngIf="item.separator" class="menu-separator"></div>

      <div *ngIf="!item.separator && item.action !== 'logout'" class="menu-option" (click)="onMenuItemClick(item)">
        <span class="menu-icon">{{ item.icon }}</span>
        <div class="menu-content">
          <span class="menu-label">{{ item.label }}</span>
        </div>
      </div>
    </div>

    <!-- Logout section - sticky at bottom -->
    <div class="logout-section" *ngIf="isAuthenticated">
      <div class="menu-separator"></div>
      <button class="logout-btn styled" (click)="logout()">
        <span class="logout-icon">üö™</span>
        <span class="logout-label">Log out</span>
      </button>
    </div>
  </div>
</div>



<!-- Location Panel -->
<div class="filter-panel" [class.active]="activePanel === 'location'">
  <div class="filter-header">
    <h2 class="filter-title">Where to?</h2>
    <button class="close-filter" (click)="closePanel()">√ó</button>
  </div>

  <div class="location-grid">
    <div *ngFor="let location of locationOptions" class="location-option"
      [class.selected]="currentFilters.location === location.value" (click)="selectLocation(location.value)">
      <div class="location-icon">{{ location.icon }}</div>
      <div class="location-info">
        <h3>{{ location.label }}</h3>
        <p>{{ location.description }}</p>
      </div>
    </div>
  </div>
</div>


<!-- Dates Panel -->
<div class="filter-panel" [class.active]="activePanel === 'dates'">
  <div class="filter-header">
    <h2 class="filter-title">When's your trip?</h2>
    <button class="close-filter" (click)="closePanel()">√ó</button>
  </div>

  <div class="dates-content">
    <!-- Selected dates display -->
    <div class="selected-dates" *ngIf="dateSelection.start || dateSelection.end">
      <div class="date-range">
        <span *ngIf="dateSelection.start">{{ formatDate(dateSelection.start) }}</span>
        <span *ngIf="dateSelection.start && dateSelection.end"> ‚Äì </span>
        <span *ngIf="dateSelection.end">{{ formatDate(dateSelection.end) }}</span>
      </div>
      <button class="clear-dates" (click)="clearDates()">Clear dates</button>
    </div>

    <!-- Enhanced Quick Actions -->
    <div class="quick-actions">
      <button class="quick-action-btn" (click)="goToCurrentMonth()">
        üìÖ Today
      </button>
      <button class="quick-action-btn" (click)="selectNextWeekend()">
        üèñÔ∏è Next weekend
      </button>
      <button class="quick-action-btn" (click)="selectNextWeek()">
        üìÖ Next week
      </button>
      <button class="quick-action-btn" (click)="selectNextMonth()">
        üóìÔ∏è Next month
      </button>
    </div>

    <div class="calendar">
      <!-- Enhanced Calendar navigation -->
      <div class="calendar-header">
        <div class="nav-controls">
          <button class="nav-button nav-year" [class.disabled]="!canNavigatePrev()"
            (click)="canNavigatePrev() && navigateYear(-1)" title="Previous year">
            ‚Äπ‚Äπ
          </button>
          <button class="nav-button nav-month" [class.disabled]="!canNavigatePrev()"
            (click)="canNavigatePrev() && navigateMonth(-1)" title="Previous month">
            ‚Äπ
          </button>
        </div>

        <div class="view-controls">
          <button class="view-button" [class.active]="calendarView === 'month'" (click)="switchToMonthView()">
            üìÖ {{ getMonthYearDisplay() }}
          </button>
          <button class="view-button" [class.active]="calendarView === 'year'" (click)="switchToYearView()">
            üóìÔ∏è {{ currentMonth.getFullYear() }}
          </button>
          <button class="view-button" [class.active]="calendarView === 'decade'" (click)="switchToDecadeView()">
            üìä {{ getCurrentDecade() }}s
          </button>
        </div>

        <div class="nav-controls">
          <button class="nav-button nav-month" [class.disabled]="!canNavigateNext()"
            (click)="canNavigateNext() && navigateMonth(1)" title="Next month">
            ‚Ä∫
          </button>
          <button class="nav-button nav-year" [class.disabled]="!canNavigateNext()"
            (click)="canNavigateNext() && navigateYear(1)" title="Next year">
            ‚Ä∫‚Ä∫
          </button>
        </div>
      </div>

      <!-- Enhanced Month View -->
      <div class="calendar-view month-view" *ngIf="calendarView === 'month'">
        <div class="calendar-grid">
          <div class="weekday" *ngFor="let day of ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa']">
            {{ day }}
          </div>

          <div *ngFor="let date of getCalendarDays()" class="calendar-day" [class.in-range]="isDateInRange(date)"
            [class.selected]="isDateSelected(date)" [class.start-date]="isDateStart(date)"
            [class.end-date]="isDateEnd(date)" [class.disabled]="isDateDisabled(date)"
            [class.other-month]="date.getMonth() !== currentMonth.getMonth()" [class.today]="isToday(date)"
            (click)="selectDate(date)">
            {{ date.getDate() }}
            <div class="date-tooltip" *ngIf="isDateDisabled(date)">
              {{ isPastDate(date) ? 'Past date' : 'Date not available' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Year View -->
      <div class="calendar-view year-view" *ngIf="calendarView === 'year'">
        <div class="year-grid">
          <div *ngFor="let month of getMonthsForYear()" class="month-option"
            [class.current]="month.number === currentMonth.getMonth()" (click)="selectMonth(month.number)">
            {{ month.name }}
          </div>
        </div>
      </div>

      <!-- Enhanced Decade View -->
      <div class="calendar-view decade-view" *ngIf="calendarView === 'decade'">
        <div class="decade-grid">
          <div *ngFor="let decade of availableDecades" class="decade-option" [class.current]="isCurrentDecade(decade)"
            (click)="selectDecade(decade)">
            {{ decade }} - {{ decade + 9 }}
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Date range info -->
    <div class="date-info" *ngIf="dateSelection.start && !dateSelection.end">
      <p>üéØ Now select your checkout date to complete your trip</p>
    </div>
  </div>
</div>

<!-- Guests Panel -->
<div class="filter-panel" [class.active]="activePanel === 'guests'">
  <div class="filter-header">
    <h2 class="filter-title">Who's coming?</h2>
    <button class="close-filter" (click)="closePanel()">√ó</button>
  </div>

  <div class="guests-content">
    <!-- Adults -->
    <div class="guest-type">
      <div class="guest-info">
        <h3>Adults</h3>
        <p>Ages 13 or above</p>
      </div>
      <div class="guest-counter">
        <button class="counter-btn" [class.disabled]="guestSelection.adults === 0"
          (click)="updateGuests('adults', -1)">‚àí</button>
        <span class="counter-value">{{ guestSelection.adults }}</span>
        <button class="counter-btn" (click)="updateGuests('adults', 1)">+</button>
      </div>
    </div>

    <!-- Children -->
    <div class="guest-type">
      <div class="guest-info">
        <h3>Children</h3>
        <p>Ages 2‚Äì12</p>
      </div>
      <div class="guest-counter">
        <button class="counter-btn" [class.disabled]="guestSelection.children === 0"
          (click)="updateGuests('children', -1)">‚àí</button>
        <span class="counter-value">{{ guestSelection.children }}</span>
        <button class="counter-btn" (click)="updateGuests('children', 1)">+</button>
      </div>
    </div>

    <!-- Infants -->
    <div class="guest-type">
      <div class="guest-info">
        <h3>Infants</h3>
        <p>Under 2</p>
      </div>
      <div class="guest-counter">
        <button class="counter-btn" [class.disabled]="guestSelection.infants === 0"
          (click)="updateGuests('infants', -1)">‚àí</button>
        <span class="counter-value">{{ guestSelection.infants }}</span>
        <button class="counter-btn" (click)="updateGuests('infants', 1)">+</button>
      </div>
    </div>

    <!-- Pets -->
    <div class="guest-type">
      <div class="guest-info">
        <h3>Pets</h3>
        <p>Bringing a service animal?</p>
      </div>
      <div class="guest-counter">
        <button class="counter-btn" [class.disabled]="guestSelection.pets === 0"
          (click)="updateGuests('pets', -1)">‚àí</button>
        <span class="counter-value">{{ guestSelection.pets }}</span>
        <button class="counter-btn" (click)="updateGuests('pets', 1)">+</button>
      </div>
    </div>

    <div class="guests-footer">
      <button class="clear-guests" (click)="clearGuests()">Clear all</button>
    </div>
  </div>
</div>

<!-- Overlay -->
<div class="overlay" [class.active]="activePanel !== null" (click)="closePanel()"></div>