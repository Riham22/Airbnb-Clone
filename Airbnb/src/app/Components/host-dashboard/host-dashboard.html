<table class="host-table">
  <thead>
    <tr>
      <th>Property</th>
      <th>Type</th>
      <th>Price</th>
      <th>Rating</th>
      <th>Bookings</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let listing of filteredListings">
      <td class="listing-cell">
        <div class="listing-image">
          <img [src]="getImageUrl(listing.images[0])" alt="listing.title">
        </div>
        <div class="listing-info">
          <strong>{{ listing.title }}</strong>
          <span class="listing-location">{{ listing.location }}</span>
        </div>
      </td>
      <td>{{ listing.type }}</td>
      <td>${{ listing.price }}/night</td>
      <td>
        <div class="rating">
          ‚≠ê {{ listing.rating }} ({{ listing.reviewCount }})
        </div>
      </td>
      <td>{{ listing.bookingsCount }}</td>
      <td>
        <span [class]="'status-badge ' + getStatusClass(listing.status)">
          {{ listing.status }}
        </span>
      </td>
      <td>
        <div class="action-buttons">
          <button *ngIf="listing.status === 'active'" (click)="updateListingStatus(listing.id, 'inactive')"
            class="btn-warning" title="Deactivate">
            Deactivate
          </button>
          <button *ngIf="listing.status === 'inactive'" (click)="updateListingStatus(listing.id, 'active')"
            class="btn-success" title="Activate">
            Activate
          </button>
          <button (click)="deleteListing(listing.id)" class="btn-danger" title="Delete">
            Delete
          </button>
        </div>
      </td>
    </tr>
  </tbody>
</table>
</div>

<div *ngIf="filteredListings.length === 0" class="empty-state">
  <div class="empty-icon">üè†</div>
  <h3 *ngIf="listings.length === 0">No properties found</h3>
  <h3 *ngIf="listings.length > 0 && filteredListings.length === 0">No properties match your search</h3>
  <p>Start by adding your first property!</p>
  <button class="btn-primary" (click)="openAddListingModal()">+ Add Property</button>
</div>
</section>

<!-- ==================== SERVICES TAB ==================== -->
<section *ngIf="activeTab === 'services'" class="tab-content">
  <div class="section-header">
    <h2>Service Management</h2>
    <div class="table-actions">
      <button class="btn-primary" (click)="openAddServiceModal()">+ Add Service</button>
      <input type="text" placeholder="Search services..." class="search-input" [(ngModel)]="searchText"
        (input)="onSearchChange($event)">
    </div>
    <div class="results-count">{{ getFilteredResultsMessage() }}</div>
  </div>

  <div class="table-container">
    <table class="host-table">
      <thead>
        <tr>
          <th>Service</th>
          <th>Category</th>
          <th>Price</th>
          <th>Rating</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let service of filteredServices">
          <td class="listing-cell">
            <div class="listing-image">
              <img [src]="getImageUrl(service.imageUrl || service.images?.[0])" alt="">
            </div>
            <div class="listing-info">
              <strong>{{ service.name }}</strong>
              <span class="listing-location">{{ service.location }}</span>
            </div>
          </td>
          <td>{{ service.category }}</td>
          <td>${{ service.price }}</td>
          <td>‚≠ê {{ service.rating }} ({{ service.reviewCount }})</td>
          <td>
            <span [class]="'status-badge ' + getStatusClass(service.status)">
              {{ service.status }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button *ngIf="service.status === 'active'" (click)="updateServiceStatus(service.id, 'inactive')"
                class="btn-warning" title="Deactivate">
                Deactivate
              </button>
              <button *ngIf="service.status === 'inactive'" (click)="updateServiceStatus(service.id, 'active')"
                class="btn-success" title="Activate">
                Activate
              </button>
              <button (click)="deleteService(service.id)" class="btn-danger" title="Delete">
                Delete
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="filteredServices.length === 0" class="empty-state">
    <div class="empty-icon">üõ†Ô∏è</div>
    <h3 *ngIf="services.length === 0">No services found</h3>
    <h3 *ngIf="services.length > 0 && filteredServices.length === 0">No services match your search</h3>
    <p>Start by adding your first service!</p>
    <button class="btn-primary" (click)="openAddServiceModal()">+ Add Service</button>
  </div>
</section>

<!-- ==================== EXPERIENCES TAB ==================== -->
<section *ngIf="activeTab === 'experiences'" class="tab-content">
  <div class="section-header">
    <h2>Experience Management</h2>
    <div class="table-actions">
      <button class="btn-primary" (click)="openAddExperienceModal()">+ Add Experience</button>
      <input type="text" placeholder="Search experiences..." class="search-input" [(ngModel)]="searchText"
        (input)="onSearchChange($event)">
    </div>
    <div class="results-count">{{ getFilteredResultsMessage() }}</div>
  </div>

  <div class="table-container">
    <table class="host-table">
      <thead>
        <tr>
          <th>Experience</th>
          <th>Category</th>
          <th>Price</th>
          <th>Rating</th>
          <th>Participants</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let experience of filteredExperiences">
          <td class="listing-cell">
            <div class="listing-image">
              <img [src]="getImageUrl(experience.imageUrl || experience.images?.[0])" alt="">
            </div>
            <div class="listing-info">
              <strong>{{ experience.name }}</strong>
              <span class="listing-location">{{ experience.location }}</span>
            </div>
          </td>
          <td>{{ experience.category }}</td>
          <td>${{ experience.price }}</td>
          <td>‚≠ê {{ experience.rating }} ({{ experience.reviewCount }})</td>
          <td>{{ experience.maxParticipants }}</td>
          <td>
            <span [class]="'status-badge ' + getStatusClass(experience.status)">
              {{ experience.status }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button *ngIf="experience.status === 'active'" (click)="updateExperienceStatus(experience.id, 'inactive')"
                class="btn-warning" title="Deactivate">
                Deactivate
              </button>
              <button *ngIf="experience.status === 'inactive'" (click)="updateExperienceStatus(experience.id, 'active')"
                class="btn-success" title="Activate">
                Activate
              </button>
              <button (click)="deleteExperience(experience.id)" class="btn-danger" title="Delete">
                Delete
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="filteredExperiences.length === 0" class="empty-state">
    <div class="empty-icon">üèÑ</div>
    <h3 *ngIf="experiences.length === 0">No experiences found</h3>
    <h3 *ngIf="experiences.length > 0 && filteredExperiences.length === 0">No experiences match your search</h3>
    <p>Start by adding your first experience!</p>
    <button class="btn-primary" (click)="openAddExperienceModal()">+ Add Experience</button>
  </div>
</section>

<!-- ==================== BOOKINGS TAB ==================== -->
<section *ngIf="activeTab === 'bookings'" class="tab-content">
  <div class="section-header">
    <h2>Booking Management</h2>
    <div class="table-actions">
      <select title="status" class="filter-select">
        <option>All Bookings</option>
        <option>Upcoming</option>
        <option>Confirmed</option>
        <option>Completed</option>
        <option>Cancelled</option>
      </select>
    </div>
  </div>

  <div class="table-container">
    <table class="host-table">
      <thead>
        <tr>
          <th>Guest</th>
          <th>Property</th>
          <th>Dates</th>
          <th>Guests</th>
          <th>Total</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let booking of bookings">
          <td class="user-cell">
            <div class="user-avatar">
              <img src="assets/default-avatar.png" alt="booking.guestName">
            </div>
            <div class="user-info">
              <strong>{{ booking.guestName }}</strong>
              <span class="user-email">{{ booking.guestEmail }}</span>
            </div>
          </td>
          <td>{{ booking.propertyName }}</td>
          <td>
            <div class="booking-dates">
              <div>{{ booking.checkIn | date:'MMM d' }}</div>
              <div>‚Üí {{ booking.checkOut | date:'MMM d' }}</div>
            </div>
          </td>
          <td>{{ booking.guests }}</td>
          <td>${{ booking.totalPrice }}</td>
          <td>
            <span [class]="'status-badge ' + getStatusClass(booking.status)">
              {{ getBookingStatusText(booking.status) }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <!-- Status-specific actions -->
              <button *ngIf="booking.status === 'pending'" (click)="updateBookingStatus(booking.id, 'confirmed')"
                class="btn-success" title="Confirm Booking">
                Confirm
              </button>
              <button *ngIf="booking.status === 'confirmed'" (click)="updateBookingStatus(booking.id, 'completed')"
                class="btn-primary" title="Mark as Completed">
                Complete
              </button>
              <button *ngIf="booking.status !== 'cancelled' && booking.status !== 'completed'"
                (click)="updateBookingStatus(booking.id, 'cancelled')" class="btn-warning" title="Cancel Booking">
                Cancel
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="bookings.length === 0" class="empty-state">
    <div class="empty-icon">üìÖ</div>
    <h3>No bookings yet</h3>
    <p>When guests book your listings, they'll appear here.</p>
  </div>
</section>

<!-- ==================== EARNINGS TAB ==================== -->
<section *ngIf="activeTab === 'earnings'" class="tab-content">
  <div class="section-header">
    <h2>Earnings Overview</h2>
    <div class="earnings-summary">
      <div class="total-earnings">
        <h3>Total Earnings</h3>
        <div class="earnings-amount">${{ stats?.totalEarnings | number }}</div>
        <p>All time earnings</p>
      </div>
      <div class="monthly-earnings">
        <h3>This Month</h3>
        <div class="earnings-amount">${{ stats?.monthlyEarnings | number }}</div>
        <p>{{ stats?.occupancyRate | number: '1.0-1' }}% occupancy rate</p>
      </div>
    </div>
  </div>

  <!-- Earnings Chart Placeholder -->
  <div class="earnings-chart">
    <div class="chart-placeholder">
      <div class="placeholder-icon">üìà</div>
      <h3>Earnings Analytics</h3>
      <p>Detailed charts and analytics coming soon.</p>
    </div>
  </div>

  <!-- Earnings Breakdown -->
  <div class="earnings-breakdown">
    <h3>Earnings Breakdown</h3>
    <div class="breakdown-list">
      <div class="breakdown-item">
        <span class="breakdown-label">Properties</span>
        <span class="breakdown-amount">${{ (stats?.totalEarnings || 0) * 0.7 | number }}</span>
      </div>
      <div class="breakdown-item">
        <span class="breakdown-label">Services</span>
        <span class="breakdown-amount">${{ (stats?.totalEarnings || 0) * 0.2 | number }}</span>
      </div>
      <div class="breakdown-item">
        <span class="breakdown-label">Experiences</span>
        <span class="breakdown-amount">${{ (stats?.totalEarnings || 0) * 0.1 | number }}</span>
      </div>
    </div>
  </div>
</section>

<!-- ==================== MODALS ==================== -->

<!-- Add Property Modal -->
<div class="modal-overlay" *ngIf="showAddListingModal">
  <div class="modal-content">
    <h3>Add New Property</h3>
    <form (ngSubmit)="addListing()">
      <div class="form-row">
        <div class="form-group">
          <label>Property Name *</label>
          <input type="text" [(ngModel)]="newListing.name" name="name" required placeholder="Enter property name">
        </div>
        <div class="form-group">
          <label>Price per Night *</label>
          <input type="number" [(ngModel)]="newListing.price" name="price" required min="0">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Location *</label>
          <input type="text" [(ngModel)]="newListing.location" name="location" required placeholder="City, Country">
        </div>
        <div class="form-group">
          <label>Max Guests *</label>
          <input type="number" [(ngModel)]="newListing.maxGuests" name="maxGuests" required min="1">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Property Type *</label>
          <select [(ngModel)]="newListing.propertyTypeId" title="propertyTypeId" name="propertyTypeId" required>
            <option [ngValue]="null" disabled>Select Property Type</option>
            <option *ngFor="let type of propertyTypes" [value]="type.id">{{ type.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Property Category *</label>
          <select [(ngModel)]="newListing.propertyCategoryId" title="propertyCategoryId" name="propertyCategoryId"
            required>
            <option [ngValue]="null" disabled>Select Category</option>
            <option *ngFor="let category of propertyCategories" [value]="category.id">{{ category.name }}</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Bedrooms</label>
          <input type="number" [(ngModel)]="newListing.bedrooms" name="bedrooms" min="0">
        </div>
        <div class="form-group">
          <label>Beds</label>
          <input type="number" [(ngModel)]="newListing.beds" name="beds" min="0">
        </div>
        <div class="form-group">
          <label>Bathrooms</label>
          <input type="number" [(ngModel)]="newListing.bathrooms" name="bathrooms" min="0">
        </div>
      </div>

      <div class="form-group">
        <label>Description *</label>
        <textarea [(ngModel)]="newListing.description" name="description" required rows="3"
          placeholder="Describe your property..."></textarea>
      </div>

      <div class="form-group">
        <label>Property Images *</label>
        <input type="file" (change)="onFileSelected($event)" multiple accept="image/*" class="form-control">
        <small>Select one or more images (first image will be used as cover)</small>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeAddListingModal()">Cancel</button>
        <button type="submit" class="btn-primary"
          [disabled]="!newListing.name || !newListing.price || !newListing.location || !newListing.propertyTypeId || !newListing.propertyCategoryId">Create
          Property</button>
      </div>
    </form>
  </div>
</div>

<!-- Add Service Modal -->
<div class="modal-overlay" *ngIf="showAddServiceModal">
  <div class="modal-content">
    <h3>Add New Service</h3>
    <form (ngSubmit)="addService()">
      <div class="form-row">
        <div class="form-group">
          <label>Service Name *</label>
          <input type="text" [(ngModel)]="newService.name" name="name" required placeholder="Enter service name">
        </div>
        <div class="form-group">
          <label>Price *</label>
          <input type="number" [(ngModel)]="newService.price" name="price" required min="0">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Location *</label>
          <input type="text" [(ngModel)]="newService.location" name="location" required>
        </div>
        <div class="form-group">
          <label>Pricing Type</label>
          <select [(ngModel)]="newService.pricingType" name="pricingType" title="pricingType">
            <option value="PerHour">Per Hour</option>
            <option value="PerDay">Per Day</option>
            <option value="Fixed">Fixed Price</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Service Category *</label>
        <select [(ngModel)]="newService.serviceCategoryId" name="serviceCategoryId" title="serviceCategoryId" required>
          <option [ngValue]="null" disabled>Select Category</option>
          <option *ngFor="let cat of serviceCategories" [value]="cat.id">{{ cat.name }}</option>
        </select>
      </div>

      <div class="form-group">
        <label>Description *</label>
        <textarea [(ngModel)]="newService.description" name="description" required rows="3"
          placeholder="Describe your service..."></textarea>
      </div>

      <div class="form-group">
        <label>Service Images</label>
        <input type="file" (change)="onFileSelected($event)" multiple accept="image/*" class="form-control">
        <small>Select one or more images</small>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeAddServiceModal()">Cancel</button>
        <button type="submit" class="btn-primary"
          [disabled]="!newService.name || !newService.price || !newService.location || !newService.serviceCategoryId">Create
          Service</button>
      </div>
    </form>
  </div>
</div>

<!-- Add Experience Modal -->
<div class="modal-overlay" *ngIf="showAddExperienceModal">
  <div class="modal-content">
    <h3>Add New Experience</h3>
    <form (ngSubmit)="addExperience()">
      <div class="form-row">
        <div class="form-group">
          <label>Experience Name *</label>
          <input type="text" [(ngModel)]="newExperience.name" name="name" required placeholder="Enter experience name">
        </div>
        <div class="form-group">
          <label>Price per Guest *</label>
          <input type="number" [(ngModel)]="newExperience.price" name="price" required min="0">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Location *</label>
          <input type="text" [(ngModel)]="newExperience.location" name="location" required>
        </div>
        <div class="form-group">
          <label>Max Participants *</label>
          <input type="number" [(ngModel)]="newExperience.maxParticipants" name="maxParticipants" required min="1"
            max="100">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Category *</label>
          <select [(ngModel)]="newExperience.expCatograyId" name="expCatograyId" title="expCatograyId" required
            (change)="onExperienceCategoryChange()">
            <option [ngValue]="null" disabled>Select Category</option>
            <option *ngFor="let cat of experienceCategories" [value]="cat.id">{{ cat.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Subcategory *</label>
          <select [(ngModel)]="newExperience.expSubCatograyId" name="expSubCatograyId" title="expSubCatograyId" required
            [disabled]="!newExperience.expCatograyId">
            <option [ngValue]="null" disabled>
              {{ newExperience.expCatograyId ? 'Select Subcategory' : 'First select a category' }}
            </option>
            <option *ngFor="let sub of experienceSubCategories" [value]="sub.id">{{ sub.name }}</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Description *</label>
        <textarea [(ngModel)]="newExperience.description" name="description" required rows="3"
          placeholder="Describe the experience..."></textarea>
      </div>

      <!-- Activities Section -->
      <div class="activities-section">
        <h4>Activities</h4>
        <div class="activity-form">
          <div class="form-row">
            <input type="text" [(ngModel)]="newActivity.name" placeholder="Activity Name" class="form-control">
            <input type="number" [(ngModel)]="newActivity.timeMinute" placeholder="Duration (min)" class="form-control"
              min="1">
          </div>
          <textarea [(ngModel)]="newActivity.describe" placeholder="Description" rows="2"
            class="form-control"></textarea>
          <button type="button" (click)="addActivity()" class="btn-secondary">+ Add Activity</button>
        </div>

        <div *ngIf="newExperience.expActivities && newExperience.expActivities.length > 0" class="activities-list">
          <div *ngFor="let act of newExperience.expActivities; let i = index" class="activity-item">
            <div class="activity-info">
              <strong>{{ act.name }}</strong>
              <span>{{ act.timeMinute }} min</span>
              <p>{{ act.describe }}</p>
            </div>
            <button type="button" (click)="removeActivity(i)" class="btn-danger">&times;</button>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Experience Images</label>
        <input type="file" (change)="onFileSelected($event)" multiple accept="image/*" class="form-control">
        <small>Select one or more images</small>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeAddExperienceModal()">Cancel</button>
        <button type="submit" class="btn-primary" [disabled]="!newExperience.name || !newExperience.price || !newExperience.location ||
                             !newExperience.expCatograyId || !newExperience.expSubCatograyId">
          Create Experience
        </button>
      </div>
    </form>
  </div>
</div>

</div>