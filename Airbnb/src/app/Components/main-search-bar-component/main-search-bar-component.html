<!-- Main search bar container -->
<div class="main-search-container">

  <div class="search-bar">
    <!-- Where -->
    <div class="search-section" [class.active]="activePanel === 'location'" (click)="openPanel('location')">
      <div class="search-label">Where</div>
      <div class="search-value">{{ getLocationDisplay() }}</div>
      <!-- Debug button (remove in production) -->
      <button class="debug-btn" *ngIf="false" (click)="debugLocations()">Debug</button>
    </div>

    <!-- When -->
    <div class="search-section" [class.active]="activePanel === 'dates'" (click)="openPanel('dates')">
      <div class="search-label">When</div>
      <div class="search-value">{{ getDatesDisplay() }}</div>
    </div>

    <!-- Who -->
    <div class="search-section" [class.active]="activePanel === 'guests'" (click)="openPanel('guests')">
      <div class="search-label">Who</div>
      <div class="search-value">{{ getGuestsDisplay() }}</div>
    </div>
  </div>

  <!-- Filter Button -->
  <div class="filter-button-container">
    <button class="filter-button" (click)="onOpenFilters()">
      <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false">
        <path d="M5 8a3 3 0 0 1 2.83 2H14v2H7.83A3 3 0 1 1 5 8zm0 2a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm6-8a3 3 0 1 1-2.83 4H2V4h6.17A3 3 0 0 1 11 2zm0 2a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"></path>
      </svg>
      <span>F</span>
    </button>
  </div>

</div>

<!-- Only render panels when activePanel is set -->

<!-- Location Panel - Dynamic Locations -->
<div *ngIf="activePanel === 'location'" class="filter-panel" [class.active]="activePanel === 'location'" style="z-index: 3000;">
  <div class="filter-header">
    <h2 class="filter-title">Where to?</h2>
    <button class="close-filter" (click)="closePanel()">×</button>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoadingLocations" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading locations from database...</p>
    <small>Fetching properties, experiences and services</small>
  </div>

  <!-- Locations grid -->
  <div *ngIf="!isLoadingLocations && locationOptions.length > 0" class="location-grid">
    <!-- "I'm flexible" option always first -->
    <div *ngFor="let location of locationOptions"
         class="location-option"
         [class.selected]="currentFilters.location === location.value"
         (click)="selectLocation(location.value)"
         [title]="location.category + ': ' + location.count + ' listings'">

      <!-- SVG Icon -->
      <div class="location-icon" [innerHTML]="location.icon" *ngIf="location.icon"></div>

      <!-- Fallback if icon is missing -->
      <div class="location-icon fallback" *ngIf="!location.icon">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="#767676">
          <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
        </svg>
      </div>

      <div class="location-info">
        <h3>{{ location.label }}</h3>
        <p>{{ location.description }}</p>

        <!-- Category badges -->
        <div class="location-metadata">
          <span class="category-badge" [class.property]="location.category.includes('property')"
                *ngIf="location.category.includes('property')">Property</span>
          <span class="category-badge" [class.experience]="location.category.includes('experience')"
                *ngIf="location.category.includes('experience')">Experience</span>
          <span class="category-badge" [class.service]="location.category.includes('service')"
                *ngIf="location.category.includes('service')">Service</span>

          <span class="location-count" *ngIf="location.count">
            {{ location.count }} listing{{ location.count > 1 ? 's' : '' }}
          </span>
        </div>
      </div>
    </div>
  </div>
<!-- في nav-bar.component.html - أضف زر debug (يمكن إزالته لاحقاً) -->
<div class="debug-tools">
  <button class="debug-btn" (click)="debugLocations()" title="Debug Data">
    Debug
  </button>
</div>
  <!-- No locations found -->
  <div *ngIf="!isLoadingLocations && locationOptions.length === 0" class="no-locations">
    <div class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="#767676">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
      <h4>No locations found</h4>
      <p>Try searching for a specific city or check if the database has listings.</p>
      <button class="retry-btn" (click)="loadDynamicLocations()">
        Retry loading locations
      </button>
    </div>
  </div>
</div>

<!-- Dates Panel -->
<div *ngIf="activePanel === 'dates'" class="filter-panel" [class.active]="activePanel === 'dates'" style="z-index: 3000;">
  <!-- ... keep existing dates panel code ... -->
</div>

<!-- Guests Panel -->
<div *ngIf="activePanel === 'guests'" class="filter-panel" [class.active]="activePanel === 'guests'" style="z-index: 3000;">
  <!-- ... keep existing guests panel code ... -->
</div>

<!-- Overlay -->
<div *ngIf="activePanel !== null" class="overlay" [class.active]="activePanel !== null" (click)="closePanel()"></div>
