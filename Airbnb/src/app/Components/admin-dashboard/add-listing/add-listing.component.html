<div class="page-container">
    <div class="page-header">
        <button class="btn-back" (click)="goBack()">← Back to Dashboard</button>
        <h1>Add New Listing</h1>
    </div>

    <div class="form-card">
        <form (ngSubmit)="onSubmit()">
            <div class="form-group">
                <label>Listing Title</label>
                <input type="text" [(ngModel)]="newListing.name" name="name" required placeholder="Cozy Downtown Appt">
            </div>

            <div class="form-group">
                <label>Description</label>
                <textarea [(ngModel)]="newListing.description" name="description" rows="4"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Price per Night</label>
                    <div style="display: flex; gap: 8px;">
                        <select [(ngModel)]="newListing.currency" name="currency"
                            style="width: 120px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                            <option value="SAR">SAR (SR)</option>
                            <option value="EGP">EGP (E£)</option>
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (€)</option>
                            <option value="GBP">GBP (£)</option>
                        </select>
                        <input type="number" [(ngModel)]="newListing.price" name="price" required min="1"
                            style="flex: 1;">
                    </div>
                </div>
                <div class="form-group">
                    <label>Location (City, Country)</label>
                    <input type="text" [(ngModel)]="newListing.location" name="location" required
                        placeholder="New York, USA">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Property Type</label>
                    <select [(ngModel)]="newListing.propertyTypeId" name="propertyType">
                        <option [ngValue]="null">Select Type</option>
                        <option *ngFor="let type of propertyTypes" [value]="type.id">{{ type.name }}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select [(ngModel)]="newListing.propertyCategoryId" name="propertyCategory">
                        <option [ngValue]="null">Select Category</option>
                        <option *ngFor="let cat of propertyCategories" [value]="cat.id">{{ cat.name }}</option>
                    </select>
                </div>
            </div>

            <!-- Details Row -->
            <div class="form-row four-col">
                <div class="form-group">
                    <label>Guests</label>
                    <input type="number" [(ngModel)]="newListing.maxGuests" name="guests">
                </div>
                <div class="form-group">
                    <label>Bedrooms</label>
                    <input type="number" [(ngModel)]="newListing.bedrooms" name="bedrooms">
                </div>
                <div class="form-group">
                    <label>Beds</label>
                    <input type="number" [(ngModel)]="newListing.beds" name="beds">
                </div>
                <div class="form-group">
                    <label>Baths</label>
                    <input type="number" [(ngModel)]="newListing.bathrooms" name="bathrooms">
                </div>
            </div>

            <div class="form-group">
                <label>Amenities</label>
                <div class="amenities-grid"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; margin-top: 8px;">
                    <div *ngFor="let amenity of amenityList" class="amenity-item"
                        style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #eee; border-radius: 6px;">
                        <input type="checkbox" [id]="'amenity-' + amenity.id" [value]="amenity.id"
                            [checked]="newListing.amenityIds?.includes(amenity.id)"
                            (change)="toggleAmenitySelection(amenity.id, $event)">
                        <label [for]="'amenity-' + amenity.id" style="margin: 0; cursor: pointer;">{{ amenity.name
                            }}</label>
                    </div>
                </div>
                <p *ngIf="amenityList.length === 0"
                    style="font-size: 0.9em; color: #666; font-style: italic; margin-top: 8px;">
                    No amenities found.
                </p>
            </div>

            <div class="form-group">
                <label>Images</label>
                <div class="file-upload">
                    <input type="file" (change)="onFileSelected($event)" multiple accept="image/*">
                    <p>Drag and drop or click to upload</p>
                </div>
                <div *ngIf="selectedFiles.length > 0" class="file-list">
                    <div *ngFor="let file of selectedFiles" class="file-item">{{ file.name }}</div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-primary" [disabled]="isLoading">
                    {{ isLoading ? 'Creating Listing...' : 'Create Listing' }}
                </button>
            </div>
        </form>
    </div>
</div>