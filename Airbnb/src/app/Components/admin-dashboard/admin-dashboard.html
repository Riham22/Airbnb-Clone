<div class="admin-dashboard">

  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner">Loading...</div>
  </div>


  <header class="admin-header">
    <h1>Admin Dashboard</h1>
    <div class="admin-actions">
      <!-- <button class="btn-secondary" (click)="testAPIs()" [disabled]="loading">
        üß™ Test APIs
      </button> -->

      <button class="btn-primary" (click)="loadDashboardData()" [disabled]="loading">
        Refresh Data
      </button>
    </div>
  </header>


  <nav class="admin-tabs">
    <button [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')" class="tab-button">
      üìä Overview
    </button>
    <button [class.active]="activeTab === 'users'" (click)="setActiveTab('users')" class="tab-button">
      üë• Users
    </button>
    <button [class.active]="activeTab === 'listings'" (click)="setActiveTab('listings')" class="tab-button">
      üè† Listings
    </button>
    <button [class.active]="activeTab === 'services'" (click)="setActiveTab('services')" class="tab-button">
      üõ†Ô∏è Services
    </button>
    <button [class.active]="activeTab === 'experiences'" (click)="setActiveTab('experiences')" class="tab-button">
      üèÑ Experiences
    </button>

    <!-- <button [class.active]="activeTab === 'analytics'" (click)="setActiveTab('analytics')" class="tab-button">
      üìà Analytics
    </button> -->
  </nav>

  <!-- Overview Tab -->
  <section *ngIf="activeTab === 'overview' && stats" class="tab-content">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
          <h3>{{ stats.totalUsers | number }}</h3>
          <p>Total Users</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üè†</div>
        <div class="stat-info">
          <h3>{{ stats.totalListings | number }}</h3>
          <p>Total Listings</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-info">
          <h3>{{ stats.totalBookings | number }}</h3>
          <p>Total Bookings</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-info">
          <h3>${{ stats.totalRevenue | number }}</h3>
          <p>Total Revenue</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-info">
          <h3>{{ stats.pendingVerifications | number }}</h3>
          <p>Pending Verifications</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üåü</div>
        <div class="stat-info">
          <h3>{{ stats.activeHosts | number }}</h3>
          <p>Active Hosts</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üõ†Ô∏è</div>
        <div class="stat-info">
          <h3>{{ stats.totalServices | number }}</h3>
          <p>Total Services</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üèÑ</div>
        <div class="stat-info">
          <h3>{{ stats.totalExperiences | number }}</h3>
          <p>Total Experiences</p>
        </div>
      </div>
    </div>

    <!-- Recent Activity Section Removed -->
    <div class="recent-activity" style="display: none;"></div>



  </section>

  <!-- Users Tab -->
  <section *ngIf="activeTab === 'users'" class="tab-content">
    <div class="section-header">
      <h2>User Management</h2>
      <div class="table-actions">
        <button class="btn-primary" [routerLink]="['/admin/add-user']">+ Add User</button>
        <input type="text" placeholder="Search users..." class="search-input" [(ngModel)]="userSearchTerm"
          (input)="filterUsers()">
        <select title="l" class="filter-select" [(ngModel)]="userRoleFilter" (change)="filterUsers()">
          <option>All Roles</option>
          <option>Hosts</option>
          <option>Guests</option>
        </select>
      </div>
    </div>

    <div class="table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th>User</th>
            <th>Role</th>
            <th>Joined</th>
            <th>Listings</th>
            <th>Bookings</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of getPaginatedUsers()">
            <td class="user-cell">
              <div class="user-avatar">
                <img alt="" [src]="user.avatar || '/assets/default-avatar.png'" [alt]="user.firstName">
              </div>
              <div class="user-info">
                <strong>{{ user.firstName }} {{ user.lastName }}</strong>
                <span class="user-email">{{ user.email }}</span>
              </div>
            </td>
            <td>
              <span [class]="'badge ' + getRoleBadgeClass(user.role)">
                {{ user.role }}
              </span>
            </td>
            <td>{{ user.joinedDate| date:'MMM d, yyyy' }}</td>
            <td>{{ user.listingsCount }}</td>
            <td>{{ user.bookingsCount }}</td>
            <td>
              <span [class]="'status-badge ' + getUserStatusClass(user.status)">
                {{ user.status }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button (click)="openEditUserModal(user)" class="btn-secondary" title="Edit User">
                  Edit
                </button>
                <button (click)="openChangeRoleModal(user)" class="btn-secondary" title="Change Role">
                  Role
                </button>
                <button *ngIf="user.status === 'active'" (click)="suspendUser(user.id)" class="btn-warning"
                  title="Suspend User">
                  Suspend
                </button>
                <button *ngIf="user.status === 'suspended'" (click)="activateUser(user.id)" class="btn-success"
                  title="Activate User">
                  Activate
                </button>
                <button (click)="deleteUser(user.id)" class="btn-danger" title="Delete User">
                  Delete
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Users Pagination -->
      <div class="pagination-controls" *ngIf="getTotalPages('users') > 1">
        <button class="btn-secondary" [disabled]="currentPageUsers === 1"
          (click)="changePage('users', currentPageUsers - 1)">Previous</button>
        <span class="pagination-info">Page {{currentPageUsers}} of {{getTotalPages('users')}}</span>
        <button class="btn-secondary" [disabled]="currentPageUsers === getTotalPages('users')"
          (click)="changePage('users', currentPageUsers + 1)">Next</button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="users.length === 0" class="empty-state">
      <div class="empty-icon">üë•</div>
      <h3>No users found</h3>
      <p>There are no users in the system yet.</p>
    </div>
  </section>

  <!-- Listings Tab -->
  <section *ngIf="activeTab === 'listings'" class="tab-content">
    <div class="section-header">
      <h2>Listing Management</h2>
      <div class="table-actions">
        <button class="btn-primary" [routerLink]="['/admin/add-listing']">+ Add Listing</button>
        <button class="btn-primary" (click)="openAddCategoryModal('property')">+ Property Category</button>
        <button class="btn-primary" (click)="openAddAmenityModal()">+ Amenity</button>
        <input type="text" placeholder="Search listings..." class="search-input" [(ngModel)]="listingSearchTerm"
          (input)="filterListings()">
        <select title="k" class="filter-select" [(ngModel)]="listingStatusFilter" (change)="filterListings()">
          <option>All Status</option>
          <option>Active</option>
          <option>Suspended</option>
          <option>Pending</option>
        </select>
      </div>
    </div>

    <div class="table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Listing</th>
            <th>Host</th>
            <th>Type</th>
            <th>Price</th>
            <th>Rating</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let listing of getPaginatedListings()">
            <td class="listing-cell">
              <div class="listing-image">
                <img [src]="getImageUrl(listing.images[0])" alt="listing.title">
              </div>
              <div class="listing-info">
                <strong>{{ listing.title }}</strong>
                <span class="listing-location">{{ listing.location }}</span>
              </div>
            </td>
            <td>{{ listing.host }}</td>
            <td>{{ listing.type }}</td>
            <td>${{ listing.price }}</td>
            <td>‚≠ê {{ listing.rating }} ({{ listing.reviewCount }})</td>
            <td>
              <span [class]="'status-badge ' + getListingStatusClass(listing.status)">
                {{ listing.status }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button (click)="openEditListingModal(listing)" class="btn-secondary" title="Edit Listing">
                  Edit
                </button>
                <button *ngIf="listing.status === 'active'" (click)="suspendListing(listing.id)" class="btn-warning"
                  title="Suspend Listing">
                  Suspend
                </button>
                <button *ngIf="listing.status !== 'active'" (click)="approveListing(listing.id)" class="btn-success"
                  title="Approve Listing">
                  Approve
                </button>
                <button (click)="deleteListing(listing.id)" class="btn-danger" title="Delete Listing">
                  Delete
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Listings Pagination -->
      <div class="pagination-controls" *ngIf="getTotalPages('listings') > 1">
        <button class="btn-secondary" [disabled]="currentPageListings === 1"
          (click)="changePage('listings', currentPageListings - 1)">Previous</button>
        <span class="pagination-info">Page {{currentPageListings}} of {{getTotalPages('listings')}}</span>
        <button class="btn-secondary" [disabled]="currentPageListings === getTotalPages('listings')"
          (click)="changePage('listings', currentPageListings + 1)">Next</button>
      </div>
    </div>

    <div *ngIf="listings.length === 0" class="empty-state">
      <div class="empty-icon">üè†</div>
      <h3>No listings found</h3>
    </div>
  </section>

  <!-- Services Tab -->
  <section *ngIf="activeTab === 'services'" class="tab-content">
    <div class="section-header">
      <h2>Service Management</h2>
      <div class="table-actions">
        <button class="btn-primary" [routerLink]="['/admin/add-service']">+ Add Service</button>
        <button class="btn-primary" (click)="openAddCategoryModal('service')">+ Service Category</button>
        <input type="text" placeholder="Search services..." class="search-input" [(ngModel)]="serviceSearchTerm"
          (input)="filterServices()">
      </div>
    </div>

    <div class="table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Service</th>
            <th>Provider</th>
            <th>Category</th>
            <th>Price</th>
            <th>Rating</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let service of getPaginatedServices()">
            <td class="listing-cell">
              <div class="listing-image">
                <img [src]="service.imageUrl || service.images?.[0] || '/assets/default-service.jpg'" alt="">
              </div>
              <div class="listing-info">
                <strong>{{ service.name }}</strong>
                <span class="listing-location">{{ service.location }}</span>
              </div>
            </td>
            <td>{{ service.provider?.name || 'Unknown' }}</td>
            <td>{{ service.category }}</td>
            <td>${{ service.price }}</td>
            <td>‚≠ê {{ service.rating }} ({{ service.reviewCount }})</td>
            <td>
              <span [class]="'status-badge ' + getListingStatusClass(service.status)">
                {{ service.status }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button (click)="openEditServiceModal(service)" class="btn-secondary" title="Edit Service">
                  Edit
                </button>
                <button *ngIf="service.status === 'active'" (click)="suspendService(service.id)" class="btn-warning"
                  title="Suspend Service">
                  Suspend
                </button>
                <button *ngIf="service.status !== 'active'" (click)="approveService(service.id)" class="btn-success"
                  title="Approve Service">
                  Approve
                </button>
                <button (click)="deleteService(service.id)" class="btn-danger" title="Delete Service">
                  Delete
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Services Pagination -->
      <div class="pagination-controls" *ngIf="getTotalPages('services') > 1">
        <button class="btn-secondary" [disabled]="currentPageServices === 1"
          (click)="changePage('services', currentPageServices - 1)">Previous</button>
        <span class="pagination-info">Page {{currentPageServices}} of {{getTotalPages('services')}}</span>
        <button class="btn-secondary" [disabled]="currentPageServices === getTotalPages('services')"
          (click)="changePage('services', currentPageServices + 1)">Next</button>
      </div>
    </div>

    <div *ngIf="services.length === 0" class="empty-state">
      <div class="empty-icon">üõ†Ô∏è</div>
      <h3>No services found</h3>
    </div>
  </section>

  <!-- Experiences Tab -->
  <section *ngIf="activeTab === 'experiences'" class="tab-content">
    <div class="section-header">
      <h2>Experiences Management</h2>
      <div class="table-actions">
        <button class="btn-primary" [routerLink]="['/admin/add-experience']">+ Add Experience</button>
        <button class="btn-primary" (click)="openAddCategoryModal('experience')">+ Experience Category</button>
        <button class="btn-primary" (click)="openAddSubcategoryModal()">+ Subcategory</button>
        <input type="text" placeholder="Search experiences..." class="search-input" [(ngModel)]="experienceSearchTerm"
          (input)="filterExperiences()">
      </div>
    </div>

    <div class="table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Experience</th>
            <th>Host</th>
            <th>Category</th>
            <th>Price</th>
            <th>Rating</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let experience of getPaginatedExperiences()">
            <td class="listing-cell">
              <div class="listing-image">
                <img [src]="experience.imageUrl || experience.images?.[0] || '/assets/default-experience.jpg'" alt="">
              </div>
              <div class="listing-info">
                <strong>{{ experience.name }}</strong>
                <span class="listing-location">{{ experience.location }}</span>
              </div>
            </td>
            <td>{{ experience.host?.name || 'Unknown' }}</td>
            <td>{{ experience.category }}</td>
            <td>${{ experience.price }}</td>
            <td>‚≠ê {{ experience.rating }} ({{ experience.reviewCount }})</td>
            <td>
              <span [class]="'status-badge ' + getListingStatusClass(experience.status)">
                {{ experience.status }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button (click)="openEditExperienceModal(experience)" class="btn-secondary" title="Edit Experience">
                  Edit
                </button>
                <button *ngIf="experience.status === 'active'" (click)="suspendExperience(experience.id)"
                  class="btn-warning" title="Suspend Experience">
                  Suspend
                </button>
                <button *ngIf="experience.status !== 'active'" (click)="approveExperience(experience.id)"
                  class="btn-success" title="Approve Experience">
                  Approve
                </button>
                <button (click)="deleteExperience(experience.id)" class="btn-danger" title="Delete Experience">
                  Delete
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Experiences Pagination -->
      <div class="pagination-controls" *ngIf="getTotalPages('experiences') > 1">
        <button class="btn-secondary" [disabled]="currentPageExperiences === 1"
          (click)="changePage('experiences', currentPageExperiences - 1)">Previous</button>
        <span class="pagination-info">Page {{currentPageExperiences}} of {{getTotalPages('experiences')}}</span>
        <button class="btn-secondary" [disabled]="currentPageExperiences === getTotalPages('experiences')"
          (click)="changePage('experiences', currentPageExperiences + 1)">Next</button>
      </div>
    </div>

    <div *ngIf="experiences.length === 0" class="empty-state">
      <div class="empty-icon">üèÑ</div>
      <h3>No experiences found</h3>
    </div>
  </section>

  <!-- Categories Tab -->
  <section *ngIf="activeTab === 'categories'" class="tab-content">
    <div class="section-header">
      <h2>Category Management</h2>
      <p>Manage experience categories and subcategories</p>
    </div>

    <!-- Service Categories -->
    <div class="management-section">
      <div class="section-title">
        <h3>Service Categories</h3>
        <button class="btn-primary" (click)="openAddCategoryModal('service')">+ Add Service Category</button>
      </div>

      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let category of serviceCategories">
            <td>{{ category.id }}</td>
            <td>{{ category.name }}</td>
            <td>{{ category.description || '-' }}</td>
            <td class="actions">
              <button class="btn-edit" (click)="openEditCategoryModal(category, 'service')">Edit</button>
              <button class="btn-delete" (click)="deleteServiceCategory(category.id)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="serviceCategories.length === 0" class="empty-state">
        <div class="empty-icon">üìÇ</div>
        <h3>No service categories found</h3>
      </div>
    </div>

    <!-- Experience Categories -->
    <div class="management-section">
      <div class="section-title">
        <h3>Experience Categories</h3>
        <button class="btn-primary" (click)="openAddCategoryModal('experience')">+ Add Category</button>
      </div>

      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>VAT</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let category of experienceCategories">
            <td>{{ category.id }}</td>
            <td>{{ category.name }}</td>
            <td>{{ category.vat }}%</td>
            <td class="actions">
              <button class="btn-edit" (click)="openEditCategoryModal(category, 'experience')">Edit</button>
              <button class="btn-delete" (click)="deleteCategory(category.id)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="experienceCategories.length === 0" class="empty-state">
        <div class="empty-icon">üìÇ</div>
        <h3>No categories found</h3>
      </div>
    </div>

    <!-- Experience Subcategories -->
    <div class="management-section">
      <div class="section-title">
        <h3>Experience Subcategories</h3>
        <button class="btn-primary" (click)="openAddSubcategoryModal()">+ Add Subcategory</button>
      </div>

      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Parent Category</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let subcategory of experienceSubCategories">
            <td>{{ subcategory.id }}</td>
            <td>{{ subcategory.name }}</td>
            <td>{{ getCategoryName(subcategory.expCatograyId) }}</td>
            <td class="actions">
              <button class="btn-edit" (click)="openEditSubcategoryModal(subcategory)">Edit</button>
              <button class="btn-delete" (click)="deleteSubcategory(subcategory.id)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="experienceSubCategories.length === 0" class="empty-state">
        <div class="empty-icon">üìÇ</div>
        <h3>No subcategories found</h3>
      </div>
    </div>
  </section>

  <!-- Analytics Tab -->
  <section *ngIf="activeTab === 'analytics'" class="tab-content">
    <div class="analytics-placeholder">
      <div class="placeholder-icon">üìà</div>
      <h3>Analytics Dashboard</h3>
      <p>Advanced analytics and reporting features coming soon.</p>
      <p>This section will include charts, graphs, and detailed performance metrics.</p>
    </div>
  </section>

  <!-- MODALS -->

  <!-- Add User Modal -->
  <div class="modal-overlay" *ngIf="showAddUserModal">
    <div class="modal-content">
      <h3>{{ isEditMode ? 'Edit User' : 'Add New User' }}</h3>
      <form (ngSubmit)="addUser()">
        <div class="form-group">
          <label>First Name</label>
          <input type="text" [(ngModel)]="newUser.firstName" name="firstName" required>
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input type="text" [(ngModel)]="newUser.lastName" name="lastName" required>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="newUser.email" name="email" required>
        </div>
        <div class="form-group" *ngIf="!isEditMode">
          <label>Password</label>
          <input type="password" [(ngModel)]="newUser.password" name="password" [required]="!isEditMode">
        </div>
        <div class="form-group" *ngIf="!isEditMode">
          <label>Role</label>
          <select [(ngModel)]="newUser.role" title="role" name="role">
            <option value="guest">Guest</option>
            <option value="host">Host</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeAddUserModal()">Cancel</button>
          <button type="submit" class="btn-primary">{{ isEditMode ? 'Update User' : 'Create User' }}</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Change Role Modal -->
  <div class="modal-overlay" *ngIf="showChangeRoleModal">
    <div class="modal-content">
      <h3>Change Role for {{ selectedUserForRole?.firstName }}</h3>
      <form (ngSubmit)="changeRole()">
        <div class="form-group">
          <label>Select New Role</label>
          <select [(ngModel)]="newRoleForUser" title="newRole" name="newRole">
            <option value="guest">Guest</option>
            <option value="host">Host</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeChangeRoleModal()">Cancel</button>
          <button type="submit" class="btn-primary">Update Role</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Listing Modal -->
  <div class="modal-overlay" *ngIf="showAddListingModal">
    <div class="modal-content">
      <h3>{{ isEditMode ? 'Edit Listing' : 'Add New Listing' }}</h3>
      <form (ngSubmit)="addListing()">
        <div class="form-group">
          <label>Name</label>
          <input type="text" [(ngModel)]="newListing.name" name="name" required>
        </div>
        <div class="form-group">
          <label>Description</label>
          <input type="text" [(ngModel)]="newListing.description" name="description" required>
        </div>
        <div class="form-group">
          <label>Price per Night</label>
          <div class="input-group">
            <select class="currency-select" title="currency" [(ngModel)]="newListing.currency" name="currency">
              <option value="SAR">SAR (SR)</option>
              <option value="EGP">EGP (E¬£)</option>
              <option value="USD">USD ($)</option>
              <option value="EUR">EUR (‚Ç¨)</option>
              <option value="GBP">GBP (¬£)</option>
            </select>
            <input type="number" [(ngModel)]="newListing.price" name="price" required min="1">
          </div>
        </div>
        <div class="form-group">
          <label>Location</label>
          <input type="text" [(ngModel)]="newListing.location" name="location" required>
        </div>
        <div class="form-group">
          <label>Property Type</label>
          <select [(ngModel)]="newListing.propertyTypeId" title="propertyTypeId" name="propertyTypeId" required>
            <option [ngValue]="null" disabled>Select Property Type</option>
            <option *ngFor="let type of propertyTypes" [value]="type.id">{{ type.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Property Category</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <select [(ngModel)]="newListing.propertyCategoryId" title="propertyCategoryId" name="propertyCategoryId"
              required style="flex-grow: 1;">
              <option [ngValue]="null" disabled>Select Property Category</option>
              <option *ngFor="let category of propertyCategories" [value]="category.id">{{ category.name }}</option>
            </select>
            <button type="button" class="btn-secondary" (click)="openAddCategoryModal('property')"
              title="Add New Category"
              style="padding: 0 12px; height: 38px; display: flex; align-items: center; justify-content: center; font-size: 20px;">+</button>
          </div>
        </div>
        <div class="form-group">
          <label>Max Guests</label>
          <input type="number" [(ngModel)]="newListing.maxGuests" name="maxGuests" required>
        </div>
        <div class="form-group">
          <label>Bedrooms</label>
          <input type="number" [(ngModel)]="newListing.bedrooms" name="bedrooms" required>
        </div>
        <div class="form-group">
          <label>Beds</label>
          <input type="number" [(ngModel)]="newListing.beds" name="beds" required>
        </div>
        <div class="form-group">
          <label>Bathrooms</label>
          <input type="number" [(ngModel)]="newListing.bathrooms" name="bathrooms" required>
        </div>

        <div class="form-group">
          <label>Amenities</label>
          <div
            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-height: 150px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
            <div *ngFor="let amenity of amenityList" style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" [value]="amenity.id" [checked]="newListing.amenityIds?.includes(amenity.id)"
                (change)="toggleAmenitySelection(amenity.id, $event)">
              <span>{{ amenity.name }}</span>
            </div>
          </div>
          <p *ngIf="amenityList.length === 0" style="font-size: 0.9em; color: #666; font-style: italic;">
            No amenities found. <a href="javascript:void(0)" (click)="openAddAmenityModal()">Create one?</a>
          </p>
        </div>
        <div class="form-group">
          <label>Images</label>
          <input type="file" (change)="onFileSelected($event)" multiple accept="image/*" class="form-control">
          <small class="text-muted" *ngIf="selectedFiles.length === 0">Select one or more images</small>
          <small class="text-success" *ngIf="selectedFiles.length > 0">{{ selectedFiles.length }} images
            selected</small>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeAddListingModal()">Cancel</button>
          <button type="submit" class="btn-primary">{{ isEditMode ? 'Update Listing' : 'Create Listing' }}</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Service Modal -->
  <div class="modal-overlay" *ngIf="showAddServiceModal">
    <div class="modal-content">
      <h3>{{ isEditMode ? 'Edit Service' : 'Add New Service' }}</h3>
      <form (ngSubmit)="addService()">
        <div class="form-group">
          <label>Service Name</label>
          <input type="text" [(ngModel)]="newService.name" name="name" required>
        </div>
        <div class="form-group">
          <label>Description</label>
          <input type="text" [(ngModel)]="newService.description" name="description" required>
        </div>
        <div class="form-group">
          <label>Category</label>
          <select [(ngModel)]="newService.serviceCategoryId" name="serviceCategoryId" title="serviceCategoryId"
            required>
            <option [ngValue]="null" disabled>Select Category</option>
            <option *ngFor="let cat of serviceCategories" [value]="cat.id">{{ cat.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Price</label>
          <input type="number" [(ngModel)]="newService.price" name="price" required>
        </div>
        <div class="form-group">
          <label>Location</label>
          <input type="text" [(ngModel)]="newService.location" name="location" required>
        </div>
        <div class="form-group">
          <label>Duration</label>
          <input type="text" [(ngModel)]="newService.duration" name="duration" required>
        </div>
        <div class="form-group">
          <label>Images</label>
          <input type="file" (change)="onFileSelected($event)" multiple accept="image/*" class="form-control">
          <small class="text-muted" *ngIf="selectedFiles.length === 0">Select one or more images</small>
          <small class="text-success" *ngIf="selectedFiles.length > 0">{{ selectedFiles.length }} images
            selected</small>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeAddServiceModal()">Cancel</button>
          <button type="submit" class="btn-primary">{{ isEditMode ? 'Update Service' : 'Create Service' }}</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Experience Modal -->
  <div class="modal-overlay" *ngIf="showAddExperienceModal">
    <div class="modal-content">
      <h3>{{ isEditMode ? 'Edit Experience' : 'Add New Experience' }}</h3>
      <form (ngSubmit)="addExperience()">
        <div class="form-group">
          <label>Experience Name *</label>
          <input type="text" [(ngModel)]="newExperience.name" name="name" required placeholder="Enter experience name">
        </div>

        <div class="form-group">
          <label>Description *</label>
          <textarea [(ngModel)]="newExperience.description" name="description" required
            placeholder="Describe the experience" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label>Category *</label>
          <option *ngFor="let cat of experienceCategories" [ngValue]="cat.id">{{ cat.name }}</option>
          <!-- </select> -->
        </div>
        <div class="form-group">
          <label>Subcategory *</label>
          <select title="k" [(ngModel)]="newExperience.expSubCatograyId" name="expSubCatograyId" required
            [disabled]="!newExperience.expCatograyId">
            <option [ngValue]="null" disabled>
              {{ newExperience.expCatograyId ? 'Select Subcategory' : 'First select a category' }}
            </option>
            <option *ngFor="let sub of experienceSubCategories" [ngValue]="sub.id">{{ sub.name }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Price per Guest *</label>
          <input type="number" [(ngModel)]="newExperience.price" name="price" required min="0"
            placeholder="Enter price">
        </div>

        <div class="form-group">
          <label>Location *</label>
          <input type="text" [(ngModel)]="newExperience.location" name="location" required placeholder="Enter location">
        </div>

        <div class="form-group">
          <label>Max Participants *</label>
          <input type="number" [(ngModel)]="newExperience.maxParticipants" name="maxParticipants" required min="1"
            max="100" placeholder="Maximum number of guests">
        </div>

        <!-- Activities Section -->
        <div class="form-group" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
          <label style="display: block; margin-bottom: 10px; font-weight: 600;">Activities</label>

          <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <input type="text" [(ngModel)]="newActivity.name" name="actName" placeholder="Activity Name"
              style="flex: 2; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            <input type="number" [(ngModel)]="newActivity.timeMinute" name="actTime" placeholder="Duration (min)"
              style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
          </div>

          <div style="margin-bottom: 10px;">
            <textarea [(ngModel)]="newActivity.describe" name="actDesc" placeholder="Description" rows="2"
              style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"></textarea>
          </div>

          <button type="button" (click)="addActivity()"
            style="background: #222; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">
            + Add Activity
          </button>

          <!-- Added Activities List -->
          <div *ngIf="newExperience.expActivities && newExperience.expActivities.length > 0"
            style="margin-top: 15px; border: 1px solid #e0e0e0; border-radius: 8px; overflow: hidden;">
            <div *ngFor="let act of newExperience.expActivities; let i = index"
              style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: start; background: #fafafa;">
              <div>
                <div style="font-weight: 600;">{{act.name}} <span
                    style="font-weight: normal; color: #666; font-size: 0.9em;">({{act.timeMinute}} min)</span></div>
                <div style="font-size: 0.9em; color: #444; margin-top: 2px;">{{act.describe}}</div>
              </div>
              <button type="button" (click)="removeActivity(i)"
                style="color: #ff385c; background: none; border: none; cursor: pointer; font-size: 18px; padding: 0 5px;">&times;</button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Images (optional)</label>
          <input type="file" (change)="onFileSelected($event)" multiple accept="image/*" class="form-control">
          <small class="text-muted" *ngIf="selectedFiles.length === 0">Select one or more images</small>
          <small class="text-success" *ngIf="selectedFiles.length > 0">{{ selectedFiles.length }} images
            selected</small>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeAddExperienceModal()">Cancel</button>
          <button type="submit" class="btn-primary" [disabled]="!newExperience.name || !newExperience.description ||
                            !newExperience.expCatograyId || !newExperience.expSubCatograyId ||
                            !newExperience.price || !newExperience.location">
            {{ isEditMode ? 'Update Experience' : 'Create Experience' }}
          </button>
        </div>
      </form>
    </div>
  </div>



  <!-- Category Modal -->
  <div *ngIf="showCategoryModal" class="modal-overlay" (click)="closeAddCategoryModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ categoryModalMode === 'edit' ? 'Edit' : 'Add New' }} {{ categoryType === 'service' ? 'Service' :
          (categoryType === 'property' ? 'Property' : 'Experience') }} Category</h2>
        <button class="close-button" (click)="closeAddCategoryModal()">&times;</button>
      </div>
      <div class="form-group">
        <label for="categoryName">Category Name *</label>
        <input type="text" id="categoryName" [(ngModel)]="newCategory.name" placeholder="Enter category name"
          required />
      </div>
      <div class="form-group">
        <label for="categoryDescription">Description</label>
        <textarea id="categoryDescription" [(ngModel)]="newCategory.description"
          placeholder="Enter category description" rows="3"></textarea>
      </div>
      <div class="modal-actions">
        <button class="btn-secondary" (click)="closeAddCategoryModal()">Cancel</button>
        <button class="btn-primary" (click)="saveCategory()">{{ categoryModalMode === 'edit' ? 'Update' : 'Create' }}
          Category</button>
      </div>
    </div>
  </div>

  <!-- Subcategory Modal -->
  <div *ngIf="showSubcategoryModal" class="modal-overlay" (click)="closeAddSubcategoryModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ subcategoryModalMode === 'edit' ? 'Edit Subcategory' : 'Add New Subcategory' }}</h2>
        <button class="close-button" (click)="closeAddSubcategoryModal()">&times;</button>
      </div>
      <div class="form-group">
        <label for="subcategoryName">Subcategory Name *</label>
        <input type="text" id="subcategoryName" [(ngModel)]="newSubcategory.name" placeholder="Enter subcategory name"
          required />
      </div>
      <div class="form-group">
        <label for="parentCategory">Parent Category *</label>
        <select id="parentCategory" [(ngModel)]="newSubcategory.expCatograyId" required>
          <option value="">Select a category</option>
          <option *ngFor="let category of experienceCategories" [value]="category.id">{{ category.name }}</option>
        </select>
      </div>
      <div class="modal-actions">
        <button class="btn-secondary" (click)="closeAddSubcategoryModal()">Cancel</button>
        <button class="btn-primary" (click)="saveSubcategory()">{{ subcategoryModalMode === 'edit' ? 'Update' : 'Create'
          }} Subcategory</button>
      </div>
    </div>
  </div>

  <div *ngIf="showAmenityModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Amenity</h2>
        <button class="close-btn" (click)="closeAmenityModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="saveAmenity()">
          <div class="form-group">
            <label>Amenity Name</label>
            <input type="text" [(ngModel)]="newAmenity.name" name="name" required class="form-control"
              placeholder="e.g. WiFi, Pool">
          </div>
          <div class="form-group">
            <label>Category</label>
            <select [(ngModel)]="newAmenity.category" name="category" class="form-control">
              <option value="Basic">Basic</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Features">Features</option>
              <option value="Internet">Internet</option>
              <option value="Location">Location</option>
              <option value="Outdoors">Outdoors</option>
              <option value="Safety">Safety</option>
              <option value="Services">Services</option>
              <option value="Utilities">Utilities</option>
            </select>
          </div>
          <div class="form-group">
            <label>Icon Class (Optional)</label>
            <input type="text" [(ngModel)]="newAmenity.icon" name="icon" class="form-control" placeholder="bi bi-wifi">
          </div>
          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="closeAmenityModal()">Cancel</button>
            <button type="submit" class="btn-primary">Save Amenity</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>