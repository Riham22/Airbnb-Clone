<!-- property-details.component.html -->
<div class="property-details-container" *ngIf="property">
  <!-- Header -->
  <header class="property-header">
    <button class="back-button" (click)="goBack()">
      <i class="fas fa-chevron-left"></i>
    </button>
    <!-- Actions removed as per request -->
  </header>

  <!-- Image Gallery (Airbnb Style Grid) -->
  <div class="image-gallery-grid">
    <!-- Main Image (Left) -->
    <div class="gallery-item main-item" (click)="togglePhotoGallery()">
      <img [src]="property.images && property.images.length > 0 ? property.images[0] : property.imageUrl"
        [alt]="property.name">
      <div class="image-overlay"></div>
    </div>

    <!-- Side Images (Right Grid) -->
    <div class="side-images">
      <div class="gallery-item side-item" *ngFor="let image of property.images | slice:1:5; let i = index"
        (click)="togglePhotoGallery()">
        <img [src]="image" [alt]="property.name">
        <div class="image-overlay"></div>
      </div>
    </div>

    <button class="view-all-photos" (click)="togglePhotoGallery()">
      <i class="fas fa-th"></i> Show all photos
    </button>
  </div>

  <!-- Full Screen Photo Carousel -->
  <div class="photo-gallery-overlay" *ngIf="showAllPhotos">
    <div class="gallery-header">
      <button class="close-gallery-btn" (click)="togglePhotoGallery()">
        <i class="fas fa-times"></i> Close
      </button>
      <div class="gallery-counter">
        {{ activeImageIndex + 1 }} / {{ property.images.length }}
      </div>
    </div>

    <div class="carousel-content">
      <button class="nav-btn prev" (click)="prevImage($event)">
        <i class="fas fa-chevron-left"></i>
      </button>

      <div class="carousel-main-image">
        <img [src]="property.images[activeImageIndex]" [alt]="property.name">
      </div>

      <button class="nav-btn next" (click)="nextImage($event)">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>

    <!-- Optional Thumbnail Strip -->
    <div class="carousel-thumbnails">
      <div *ngFor="let img of property.images; let i = index" class="carousel-thumb"
        [class.active]="i === activeImageIndex" (click)="activeImageIndex = i">
        <img [src]="img" alt="">
      </div>
    </div>
  </div>

  <!-- Property Info Section -->
  <div class="property-content">
    <div class="main-content">
      <!-- Property Header -->
      <div class="property-info-header">
        <h1>{{ property.name }}</h1>
        <div class="property-rating">
          <span class="stars">★</span>
          <span class="rating">{{ property.rating }}</span>
          <span class="reviews">({{ property.reviewCount }} reviews)</span>
        </div>
        <p class="property-location">
          <i class="fas fa-map-marker-alt"></i> {{ property.location }}
        </p>
      </div>

      <!-- Property Highlights -->
      <div class="property-highlights" *ngIf="property.highlights?.length">
        <div class="highlight-item" *ngFor="let highlight of property.highlights">
          <i class="fas fa-check-circle"></i> {{ highlight }}
        </div>
      </div>

      <!-- Property Details -->
      <div class="property-details-grid">
        <div class="detail-item">
          <i class="fas fa-home"></i>
          <div>
            <strong>{{ property.type }}</strong>
            <span>Entire place to yourself</span>
          </div>
        </div>
        <div class="detail-item">
          <i class="fas fa-user-friends"></i>
          <div>
            <strong>Up to {{ $any(property).maxGuests || $any(property).maxParticipants || property.maxGuests }}
              guests</strong>
            <span *ngIf="property.type === 'property'">{{ property.bedrooms }} bedrooms · {{ property.beds }} beds · {{
              property.bathrooms }} baths</span>
            <span *ngIf="property.type !== 'property'">{{ $any(property).duration }} duration</span>
          </div>
        </div>
      </div>

      <!-- Amenities -->
      <div class="amenities-section">
        <h2>What this place offers</h2>
        <div class="amenities-grid">
          <div class="amenity-item" *ngFor="let amenity of displayedAmenities">
            <i class="fas fa-check-circle"></i> {{ amenity }}
          </div>
        </div>
        <button class="show-more-btn" (click)="toggleAmenities()">
          {{ showAllAmenities ? 'Show less' : 'Show all amenities' }}
        </button>
      </div>

      <!-- Description -->
      <div class="description-section">
        <h2>About this place</h2>
        <p>{{ property.description }}</p>
      </div>

      <!-- Service Specific Details -->
      <div class="service-details" *ngIf="property.type === 'service'">
        <div *ngIf="$any(property).includes?.length" class="detail-block">
          <h3>What's Included</h3>
          <ul>
            <li *ngFor="let inc of $any(property).includes">{{ inc }}</li>
          </ul>
        </div>
        <div *ngIf="$any(property).requirements?.length" class="detail-block">
          <h3>Requirements</h3>
          <ul>
            <li *ngFor="let req of $any(property).requirements">{{ req }}</li>
          </ul>
        </div>
      </div>

      <!-- Experience Activities -->
      <div class="activities-section" *ngIf="property.type === 'experience' && $any(property).activities?.length > 0">
        <h2>What we'll do</h2>
        <div class="activities-list">
          <div class="activity-item" *ngFor="let activity of $any(property).activities">
            <div class="activity-header">
              <h3>{{ activity.name }}</h3>
              <span class="activity-duration" *ngIf="activity.durationMinutes > 0">
                <i class="far fa-clock"></i> {{ activity.durationMinutes }} mins
              </span>
            </div>
            <p>{{ activity.description }}</p>
          </div>
        </div>
      </div>

      <!-- Reviews -->
      <div class="reviews-section" *ngIf="property">
        <app-review-list [itemId]="property.id" type="property"></app-review-list>

        <button class="write-review-btn mt-4" *ngIf="hasBooking" (click)="openReviewModal()">
          <i class="fas fa-pen"></i> Write request a review
        </button>
      </div>

      <!-- Review Modal -->
      <div class="modal-overlay" *ngIf="showReviewModal" (click)="closeReviewModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div style="display: flex; justify-content: flex-end;">
            <button (click)="closeReviewModal()" class="text-gray-500 hover:text-gray-700">✕</button>
          </div>
          <app-review-form [itemId]="property.id" type="property" (reviewSubmitted)="onReviewSubmitted()">
          </app-review-form>
        </div>
      </div>

      <!-- Host Info -->
      <div class="host-section" *ngIf="property.host">
        <h2>Hosted by {{ property.host.name }}</h2>
        <div class="host-info">
          <i class="fas fa-user-circle host-avatar-icon"></i>
          <div class="host-details">
            <div class="host-badge" *ngIf="property.host.isSuperhost">
              <i class="fas fa-medal"></i> Superhost
            </div>
            <p>Joined in {{ property.host.joinedDate }}</p>
          </div>
        </div>
        <button class="contact-host-btn">Contact Host</button>
      </div>
    </div>

    <!-- Booking Widget -->
    <div class="booking-widget">
      <div class="price-section">
        <span class="price">${{ property.price }}</span>
        <span class="period">night</span>
      </div>

      <div class="date-selector">
        <div class="date-input">
          <label>CHECK-IN</label>
          <input name="" title="l" alt="" type="date" [(ngModel)]="checkInDate">
        </div>
        <div class="date-input">
          <label>CHECKOUT</label>
          <input title="l" alt="" type="date" [(ngModel)]="checkOutDate">
        </div>
      </div>

      <div class="guests-selector">
        <label>GUESTS</label>
        <select title="guests" name="guests" [(ngModel)]="guests">
          <option *ngFor="let num of getGuestOptions()" [value]="num">{{ num }} guest{{ num > 1 ? 's' : '' }}</option>
        </select>
      </div>

      <button class="reserve-btn" (click)="reserveProperty()">Reserve</button>

      <div class="price-breakdown">
        <div class="price-item">
          <span>${{ property.price }} x {{ nights }} nights</span>
          <span>${{ property.price * nights }}</span>
        </div>
        <div class="price-item">
          <span>Cleaning fee</span>
          <span>${{ cleaningFee }}</span>
        </div>
        <div class="price-item">
          <span>Service fee</span>
          <span>${{ serviceFee }}</span>
        </div>
        <div class="price-total">
          <strong>Total</strong>
          <strong>${{ calculateTotalPrice() }}</strong>
        </div>
      </div>
    </div>
  </div>

  <!-- Suggestions Section -->
  <div class="suggestions-section" *ngIf="suggestions.length > 0">
    <h2>You might also like</h2>
    <div class="suggestions-grid">
      <div class="suggestion-card" *ngFor="let item of suggestions" [routerLink]="['/' + property.type, item.id]">
        <div class="suggestion-image-container">
          <img [src]="item.imageUrl || item.images?.[0]" [alt]="item.name">
        </div>
        <div class="suggestion-info">
          <h4>{{ item.name }}</h4>
          <p>{{ item.location }}</p>
          <span class="price">${{ item.price }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
<div *ngIf="!property" class="loading-container">
  <p>Loading property details...</p>
</div>